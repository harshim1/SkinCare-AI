<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkinCare AI - Personalized Skincare Recommendations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .header {
            background: linear-gradient(45deg, #ff6b6b, #ffa8a8);
            color: white;
            text-align: center;
            padding: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .step {
            display: none;
            padding: 40px;
            animation: fadeIn 0.5s ease-in;
        }
        
        .step.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .step h2 {
            color: #333;
            margin-bottom: 25px;
            font-size: 1.8rem;
            text-align: center;
        }
        
        .camera-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        #video {
            width: 100%;
            max-width: 400px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }
        
        #canvas {
            display: none;
        }
        
        .captured-photo {
            max-width: 300px;
            border-radius: 15px;
            margin: 20px auto;
            display: block;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .question-group {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 4px solid #ff6b6b;
        }
        
        .question-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            font-size: 1.1rem;
        }
        
        .question-group input, .question-group select, .question-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .question-group input:focus, .question-group select:focus, .question-group textarea:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .checkbox-item:hover {
            background: #fff5f5;
            transform: translateY(-1px);
        }
        
        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
            transform: scale(1.2);
        }
        
        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ffa8a8);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #6c757d, #868e96);
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
        }
        
        .results {
            background: linear-gradient(135deg, #e3ffe7 0%, #d9ffd9 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .analysis-result {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .analysis-result h3 {
            color: #2d5a2d;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        .recommendations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .recommendation-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .recommendation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        
        .recommendation-card h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
            border-bottom: 3px solid #ff6b6b;
            padding-bottom: 10px;
        }
        
        .product-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #28a745;
        }
        
        .product-item h5 {
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .product-item p {
            color: #666;
            margin-bottom: 5px;
            line-height: 1.5;
        }
        
        .price-range {
            color: #28a745;
            font-weight: 600;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #ff6b6b, #ffa8a8);
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .step-indicator {
            text-align: center;
            margin-bottom: 20px;
            color: #666;
            font-weight: 500;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ff6b6b;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .step {
                padding: 20px;
            }
            
            .recommendations {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>✨ SkinCare AI</h1>
            <p>Personalized skincare recommendations powered by AI</p>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
        </div>
        
        <!-- Step 1: Face Capture -->
        <div class="step active" id="step1">
            <div class="step-indicator">Step 1 of 3: Face Analysis</div>
            <h2>📸 Capture Your Face</h2>
            <div class="camera-section">
                <video id="video" autoplay playsinline></video>
                <canvas id="canvas"></canvas>
                <div id="capturedPhotoDiv" style="display: none;">
                    <img id="capturedPhoto" class="captured-photo" alt="Captured face">
                </div>
                <div>
                    <button class="btn" id="startCamera">Start Camera</button>
                    <button class="btn" id="captureBtn" style="display: none;">Capture Photo</button>
                    <button class="btn" id="retakeBtn" style="display: none;">Retake Photo</button>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" id="nextStep1" style="display: none;">Continue to Questionnaire</button>
            </div>
        </div>
        
        <!-- Step 2: Questionnaire -->
        <div class="step" id="step2">
            <div class="step-indicator">Step 2 of 3: Skin Assessment</div>
            <h2>📋 Tell Us About Your Skin</h2>
            
            <div class="question-group">
                <label>What's your age range?</label>
                <select id="age">
                    <option value="">Select age range</option>
                    <option value="teens">13-19</option>
                    <option value="twenties">20-29</option>
                    <option value="thirties">30-39</option>
                    <option value="forties">40-49</option>
                    <option value="fifties">50-59</option>
                    <option value="sixty-plus">60+</option>
                </select>
            </div>
            
            <div class="question-group">
                <label>How would you describe your skin type?</label>
                <select id="skinType">
                    <option value="">Select skin type</option>
                    <option value="oily">Oily - Shiny, prone to breakouts</option>
                    <option value="dry">Dry - Tight, flaky, rough texture</option>
                    <option value="combination">Combination - Oily T-zone, dry cheeks</option>
                    <option value="normal">Normal - Balanced, not too oily or dry</option>
                    <option value="sensitive">Sensitive - Easily irritated, reactive</option>
                </select>
            </div>
            
            <div class="question-group">
                <label>What are your main skin concerns? (Check all that apply)</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="acne" name="concerns" value="acne">
                        <label for="acne">Acne/Breakouts</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="wrinkles" name="concerns" value="wrinkles">
                        <label for="wrinkles">Fine Lines/Wrinkles</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="dark-spots" name="concerns" value="dark-spots">
                        <label for="dark-spots">Dark Spots/Hyperpigmentation</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="dullness" name="concerns" value="dullness">
                        <label for="dullness">Dull/Uneven Skin Tone</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="pores" name="concerns" value="pores">
                        <label for="pores">Large Pores</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="dryness" name="concerns" value="dryness">
                        <label for="dryness">Dryness/Dehydration</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="redness" name="concerns" value="redness">
                        <label for="redness">Redness/Irritation</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="blackheads" name="concerns" value="blackheads">
                        <label for="blackheads">Blackheads</label>
                    </div>
                </div>
            </div>
            
            <div class="question-group">
                <label>How often do you break out?</label>
                <select id="breakoutFreq">
                    <option value="">Select frequency</option>
                    <option value="never">Never/Rarely</option>
                    <option value="monthly">Once a month</option>
                    <option value="weekly">Weekly</option>
                    <option value="daily">Daily/Constantly</option>
                </select>
            </div>
            
            <div class="question-group">
                <label>What's your current skincare routine?</label>
                <select id="routine">
                    <option value="">Select routine level</option>
                    <option value="minimal">Minimal (just cleanser or nothing)</option>
                    <option value="basic">Basic (cleanser + moisturizer)</option>
                    <option value="moderate">Moderate (3-5 products)</option>
                    <option value="extensive">Extensive (6+ products)</option>
                </select>
            </div>
            
            <div class="question-group">
                <label>How does your skin feel throughout the day?</label>
                <select id="dailyFeel">
                    <option value="">Select feeling</option>
                    <option value="comfortable">Comfortable all day</option>
                    <option value="tight-morning">Tight in the morning</option>
                    <option value="oily-afternoon">Gets oily by afternoon</option>
                    <option value="varies">Varies by area (T-zone vs cheeks)</option>
                    <option value="irritated">Often feels irritated</option>
                </select>
            </div>
            
            <div class="question-group">
                <label>Do you have any known allergies or sensitivities to skincare ingredients?</label>
                <textarea id="allergies" rows="3" placeholder="List any known allergies or sensitivities (e.g., fragrances, salicylic acid, etc.)"></textarea>
            </div>
            
            <div class="question-group">
                <label>What's your budget preference for skincare products?</label>
                <select id="budget">
                    <option value="">Select budget range</option>
                    <option value="budget">Budget-friendly ($5-15 per product)</option>
                    <option value="mid-range">Mid-range ($15-40 per product)</option>
                    <option value="high-end">High-end ($40+ per product)</option>
                    <option value="mixed">I'm open to mixing budget levels</option>
                </select>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-secondary" id="backStep1">Back</button>
                <button class="btn" id="nextStep2">Analyze My Skin</button>
            </div>
        </div>
        
        <!-- Step 3: Loading & Results -->
        <div class="step" id="step3">
            <div class="step-indicator">Step 3 of 3: Your Personalized Results</div>
            
            <div class="loading" id="loadingDiv">
                <div class="spinner"></div>
                <h3>🔬 Analyzing Your Skin...</h3>
                <p>Our AI is processing your photo and questionnaire responses to create personalized recommendations.</p>
            </div>
            
            <div id="resultsDiv" style="display: none;">
                <h2>🎯 Your Personalized Skincare Plan</h2>
                
                <div class="results">
                    <div class="analysis-result">
                        <h3>📊 Skin Analysis Summary</h3>
                        <div id="skinAnalysis"></div>
                    </div>
                    
                    <div class="analysis-result">
                        <h3>🎯 Recommended Routine</h3>
                        <div id="routineSteps"></div>
                    </div>
                </div>
                
                <div class="recommendations" id="recommendationsDiv">
                    <!-- Product recommendations will be inserted here -->
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-secondary" id="backStep2">Back to Questionnaire</button>
                    <button class="btn" id="startOver">Start Over</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentStep = 1;
        let stream = null;
        let capturedImageData = null;
        let analysisResults = {};
        let skinAnalysisModel = null;

        // Load custom AI model on page load
        async function loadCustomModel() {
            try {
                // Replace with your model path
                skinAnalysisModel = await tf.loadLayersModel('/models/skin_analysis_model/model.json');
                console.log('Custom skin analysis model loaded successfully');
            } catch (error) {
                console.log('Custom model not available, using rule-based analysis');
                skinAnalysisModel = null;
            }
        }

        // DOM elements
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const capturedPhoto = document.getElementById('capturedPhoto');
        const capturedPhotoDiv = document.getElementById('capturedPhotoDiv');
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updateProgress();
            loadCustomModel(); // Load AI model
        });

        function setupEventListeners() {
            // Camera controls
            document.getElementById('startCamera').addEventListener('click', startCamera);
            document.getElementById('captureBtn').addEventListener('click', capturePhoto);
            document.getElementById('retakeBtn').addEventListener('click', retakePhoto);
            
            // Navigation
            document.getElementById('nextStep1').addEventListener('click', () => goToStep(2));
            document.getElementById('nextStep2').addEventListener('click', analyzeAndShowResults);
            document.getElementById('backStep1').addEventListener('click', () => goToStep(1));
            document.getElementById('backStep2').addEventListener('click', () => goToStep(2));
            document.getElementById('startOver').addEventListener('click', () => location.reload());
        }

        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: 'user'
                    } 
                });
                video.srcObject = stream;
                
                document.getElementById('startCamera').style.display = 'none';
                document.getElementById('captureBtn').style.display = 'inline-block';
            } catch (err) {
                alert('Camera access denied. Please allow camera access and try again.');
                console.error('Camera error:', err);
            }
        }

        function capturePhoto() {
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);
            
            capturedImageData = canvas.toDataURL('image/jpeg', 0.8);
            capturedPhoto.src = capturedImageData;
            
            // Stop video stream
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            
            // Update UI
            video.style.display = 'none';
            capturedPhotoDiv.style.display = 'block';
            document.getElementById('captureBtn').style.display = 'none';
            document.getElementById('retakeBtn').style.display = 'inline-block';
            document.getElementById('nextStep1').style.display = 'inline-block';
        }

        function retakePhoto() {
            video.style.display = 'block';
            capturedPhotoDiv.style.display = 'none';
            document.getElementById('retakeBtn').style.display = 'none';
            document.getElementById('nextStep1').style.display = 'none';
            document.getElementById('startCamera').style.display = 'inline-block';
            capturedImageData = null;
        }

        function goToStep(step) {
            // Hide current step
            document.querySelector('.step.active').classList.remove('active');
            
            // Show target step
            document.getElementById(`step${step}`).classList.add('active');
            currentStep = step;
            updateProgress();
        }

        function updateProgress() {
            const progress = ((currentStep - 1) / 2) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function gatherQuestionnaireData() {
            const concerns = Array.from(document.querySelectorAll('input[name="concerns"]:checked'))
                .map(cb => cb.value);
            
            return {
                age: document.getElementById('age').value,
                skinType: document.getElementById('skinType').value,
                concerns: concerns,
                breakoutFreq: document.getElementById('breakoutFreq').value,
                routine: document.getElementById('routine').value,
                dailyFeel: document.getElementById('dailyFeel').value,
                allergies: document.getElementById('allergies').value,
                budget: document.getElementById('budget').value
            };
        }

        function analyzeAndShowResults() {
            const data = gatherQuestionnaireData();
            
            // Validate required fields
            if (!data.age || !data.skinType || !data.budget) {
                alert('Please fill in all required fields (age, skin type, and budget).');
                return;
            }
            
            goToStep(3);
            
            // Simulate AI analysis with realistic delay
            setTimeout(() => {
                analysisResults = performSkinAnalysis(data);
                displayResults(analysisResults);
                
                document.getElementById('loadingDiv').style.display = 'none';
                document.getElementById('resultsDiv').style.display = 'block';
            }, 3000);
        }

        // AI-powered image analysis
        async function analyzeWithCustomAI(imageElement) {
            if (!skinAnalysisModel) {
                return null; // Fallback to rule-based
            }
            
            try {
                // Preprocess image for model
                const tensor = tf.browser.fromPixels(imageElement)
                    .resizeNearestNeighbor([224, 224])
                    .expandDims(0)
                    .div(255.0);
                
                // Make predictions
                const predictions = await skinAnalysisModel.predict(tensor);
                
                // Process results (assuming multi-output model)
                const skinTypeProbs = await predictions.data();
                
                // Convert to human-readable results
                const skinTypes = ['oily', 'dry', 'combination', 'normal', 'sensitive'];
                const maxIndex = skinTypeProbs.indexOf(Math.max(...skinTypeProbs));
                const predictedSkinType = skinTypes[maxIndex];
                const confidence = skinTypeProbs[maxIndex];
                
                // Clean up tensor
                tensor.dispose();
                
                return {
                    skinType: predictedSkinType,
                    confidence: confidence,
                    source: 'AI Analysis'
                };
                
            } catch (error) {
                console.error('Error during AI analysis:', error);
                return null;
            }
        }

        function performSkinAnalysis(data) {
            // Enhanced analysis logic combining AI + questionnaire
            const analysis = {
                skinType: data.skinType,
                primaryConcerns: data.concerns.slice(0, 3),
                routineComplexity: determineRoutineComplexity(data),
                recommendations: generateRecommendations(data),
                aiEnhanced: false
            };
            
            // If we have a captured image, try AI analysis
            if (capturedImageData && skinAnalysisModel) {
                // Create image element from captured data
                const img = new Image();
                img.onload = async () => {
                    const aiResult = await analyzeWithCustomAI(img);
                    if (aiResult) {
                        analysis.aiPrediction = aiResult;
                        analysis.aiEnhanced = true;
                        
                        // Compare AI vs questionnaire
                        if (aiResult.skinType !== data.skinType && aiResult.confidence > 0.7) {
                            analysis.aiSuggestion = `Our AI detected ${aiResult.skinType} skin type with ${Math.round(aiResult.confidence * 100)}% confidence, but you selected ${data.skinType}. You might want to consider this in your routine.`;
                        }
                    }
                };
                img.src = capturedImageData;
            }
            
            return analysis;
        }

        function determineRoutineComplexity(data) {
            const concernCount = data.concerns.length;
            const currentRoutine = data.routine;
            
            if (concernCount <= 2 && (currentRoutine === 'minimal' || currentRoutine === 'basic')) {
                return 'simple';
            } else if (concernCount <= 4) {
                return 'moderate';
            } else {
                return 'comprehensive';
            }
        }

        function generateRecommendations(data) {
            const recommendations = {
                drugstore: [],
                highEnd: [],
                korean: [],
                homemade: []
            };

            // Cleanser recommendations
            if (data.skinType === 'oily' || data.concerns.includes('acne')) {
                recommendations.drugstore.push({
                    name: "CeraVe Foaming Facial Cleanser",
                    purpose: "Daily cleanser for oily/acne-prone skin",
                    price: "$8-12"
                });
                recommendations.highEnd.push({
                    name: "La Roche-Posay Effaclar Medicated Gel Cleanser",
                    purpose: "Salicylic acid cleanser for acne control",
                    price: "$15-20"
                });
                recommendations.korean.push({
                    name: "COSRX Low pH Good Morning Gel Cleanser",
                    purpose: "Gentle daily cleanser with tea tree oil",
                    price: "$10-15"
                });
                recommendations.homemade.push({
                    name: "Honey & Oatmeal Cleanser",
                    purpose: "Mix 1 tbsp honey + 1 tbsp ground oatmeal, gentle massage",
                    price: "$2-3"
                });
            } else if (data.skinType === 'dry' || data.skinType === 'sensitive') {
                recommendations.drugstore.push({
                    name: "Cetaphil Gentle Skin Cleanser",
                    purpose: "Non-foaming cleanser for sensitive skin",
                    price: "$6-10"
                });
                recommendations.highEnd.push({
                    name: "Drunk Elephant Beste No. 9 Jelly Cleanser",
                    purpose: "Biocompatible cleanser for sensitive skin",
                    price: "$32-35"
                });
                recommendations.korean.push({
                    name: "Banila Co Clean It Zero Cleansing Balm",
                    purpose: "Gentle oil-based cleanser",
                    price: "$18-22"
                });
                recommendations.homemade.push({
                    name: "Milk & Rose Water Cleanser",
                    purpose: "Mix equal parts milk and rose water for gentle cleansing",
                    price: "$3-5"
                });
            }

            // Moisturizer recommendations
            if (data.skinType === 'oily') {
                recommendations.drugstore.push({
                    name: "Neutrogena Oil-Free Moisture Gel",
                    purpose: "Lightweight, non-comedogenic moisturizer",
                    price: "$7-10"
                });
                recommendations.highEnd.push({
                    name: "Clinique Dramatically Different Moisturizing Gel",
                    purpose: "Oil-free hydration for oily skin",
                    price: "$28-32"
                });
                recommendations.korean.push({
                    name: "Belif The True Cream Aqua Bomb",
                    purpose: "Gel-cream hybrid for oily skin hydration",
                    price: "$38-42"
                });
                recommendations.homemade.push({
                    name: "Aloe Vera & Green Tea Gel",
                    purpose: "Mix aloe vera gel with cooled green tea for light hydration",
                    price: "$4-6"
                });
            } else if (data.skinType === 'dry') {
                recommendations.drugstore.push({
                    name: "CeraVe Daily Moisturizing Lotion",
                    purpose: "Ceramides and hyaluronic acid for dry skin",
                    price: "$10-15"
                });
                recommendations.highEnd.push({
                    name: "La Mer Moisturizing Cream",
                    purpose: "Luxury hydration with miracle broth",
                    price: "$95-185"
                });
                recommendations.korean.push({
                    name: "Laneige Water Sleeping Mask",
                    purpose: "Overnight hydration treatment",
                    price: "$25-30"
                });
                recommendations.homemade.push({
                    name: "Shea Butter & Jojoba Oil Cream",
                    purpose: "Whip shea butter with few drops jojoba oil",
                    price: "$8-12"
                });
            }

            // Treatment recommendations based on concerns
            if (data.concerns.includes('acne')) {
                recommendations.drugstore.push({
                    name: "The Ordinary Niacinamide 10% + Zinc 1%",
                    purpose: "Reduces sebum production and blemishes",
                    price: "$7"
                });
                recommendations.highEnd.push({
                    name: "Paula's Choice CLEAR 2% BHA Liquid Exfoliant",
                    purpose: "Salicylic acid for acne treatment",
                    price: "$30"
                });
                recommendations.korean.push({
                    name: "Some By Mi Red Tea Tree Spot Treatment",
                    purpose: "Tea tree oil for targeted acne treatment",
                    price: "$12-15"
                });
                recommendations.homemade.push({
                    name: "Tea Tree & Clay Spot Treatment",
                    purpose: "Mix bentonite clay with tea tree oil and water",
                    price: "$5-8"
                });
            }

            if (data.concerns.includes('wrinkles') || data.concerns.includes('dark-spots')) {
                recommendations.drugstore.push({
                    name: "Olay Regenerist Micro-Sculpting Cream",
                    purpose: "Anti-aging with amino-peptides and niacinamide",
                    price: "$18-25"
                });
                recommendations.highEnd.push({
                    name: "Skinceuticals CE Ferulic Vitamin C Serum",
                    purpose: "Antioxidant protection and brightening",
                    price: "$165-175"
                });
                recommendations.korean.push({
                    name: "Missha Time Revolution Night Repair Ampoule",
                    purpose: "Fermented ingredients for anti-aging",
                    price: "$25-35"
                });
                recommendations.homemade.push({
                    name: "Vitamin C & E Face Serum",
                    purpose: "Mix vitamin C powder with vitamin E oil and rosehip oil",
                    price: "$10-15"
                });
            }

            if (data.concerns.includes('dullness')) {
                recommendations.drugstore.push({
                    name: "The INKEY List Vitamin C Serum",
                    purpose: "Brightening serum with stable vitamin C",
                    price: "$10-12"
                });
                recommendations.highEnd.push({
                    name: "Sunday Riley C.E.O. Vitamin C Rich Hydration Cream",
                    purpose: "Advanced vitamin C with THD ascorbate",
                    price: "$65-85"
                });
                recommendations.korean.push({
                    name: "Klairs Freshly Juiced Vitamin C Serum",
                    purpose: "Gentle vitamin C for sensitive skin",
                    price: "$17-23"
                });
                recommendations.homemade.push({
                    name: "Turmeric & Honey Brightening Mask",
                    purpose: "Weekly mask: 1 tsp turmeric + 2 tbsp honey",
                    price: "$3-5"
                });
            }

            // Sunscreen recommendations (essential for everyone)
            recommendations.drugstore.push({
                name: "EltaMD UV Clear Broad-Spectrum SPF 46",
                purpose: "Daily sun protection with zinc oxide",
                price: "$15-20"
            });
            recommendations.highEnd.push({
                name: "La Roche-Posay Anthelios Ultra Light Fluid SPF 60",
                purpose: "Lightweight, non-greasy daily sunscreen",
                price: "$25-35"
            });
            recommendations.korean.push({
                name: "Beauty of Joseon Relief Sun Rice + Probiotics SPF50+",
                purpose: "Lightweight, hydrating Korean sunscreen",
                price: "$15-18"
            });
            recommendations.homemade.push({
                name: "Zinc Oxide Sunscreen Base",
                purpose: "Mix zinc oxide powder with coconut oil (20% zinc)",
                price: "$8-12"
            });

            return recommendations;
        }

        function displayResults(results) {
            // Display skin analysis
            const analysisDiv = document.getElementById('skinAnalysis');
            analysisDiv.innerHTML = `
                <p><strong>Skin Type:</strong> ${formatSkinType(results.skinType)}</p>
                <p><strong>Primary Concerns:</strong> ${results.primaryConcerns.map(formatConcern).join(', ')}</p>
                <p><strong>Recommended Routine Level:</strong> ${formatRoutineComplexity(results.routineComplexity)}</p>
            `;

            // Display routine steps
            const routineDiv = document.getElementById('routineSteps');
            const routineSteps = generateRoutineSteps(results);
            routineDiv.innerHTML = routineSteps;

            // Display product recommendations
            const recommendationsDiv = document.getElementById('recommendationsDiv');
            recommendationsDiv.innerHTML = '';

            const categories = [
                { key: 'drugstore', title: '🏪 Drugstore Picks', subtitle: 'Affordable and effective options' },
                { key: 'highEnd', title: '✨ High-End Brands', subtitle: 'Premium formulations and luxury experience' },
                { key: 'korean', title: '🌸 K-Beauty Favorites', subtitle: 'Innovative Korean skincare solutions' },
                { key: 'homemade', title: '🏠 DIY Natural Remedies', subtitle: 'Budget-friendly homemade alternatives' }
            ];

            categories.forEach(category => {
                if (results.recommendations[category.key].length > 0) {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'recommendation-card';
                    categoryDiv.innerHTML = `
                        <h4>${category.title}</h4>
                        <p style="color: #666; margin-bottom: 20px; font-style: italic;">${category.subtitle}</p>
                        ${results.recommendations[category.key].map(product => `
                            <div class="product-item">
                                <h5>${product.name}</h5>
                                <p>${product.purpose}</p>
                                <p class="price-range">Price: ${product.price}</p>
                            </div>
                        `).join('')}
                    `;
                    recommendationsDiv.appendChild(categoryDiv);
                }
            });
        }

        function formatSkinType(skinType) {
            const types = {
                'oily': 'Oily - Produces excess sebum, prone to shine',
                'dry': 'Dry - Lacks moisture, may feel tight or flaky',
                'combination': 'Combination - Mixed oily and dry areas',
                'normal': 'Normal - Well-balanced, healthy skin',
                'sensitive': 'Sensitive - Easily irritated, reactive to products'
            };
            return types[skinType] || skinType;
        }

        function formatConcern(concern) {
            const concerns = {
                'acne': 'Acne & Breakouts',
                'wrinkles': 'Fine Lines & Wrinkles',
                'dark-spots': 'Dark Spots & Hyperpigmentation',
                'dullness': 'Dull & Uneven Skin Tone',
                'pores': 'Large Pores',
                'dryness': 'Dryness & Dehydration',
                'redness': 'Redness & Irritation',
                'blackheads': 'Blackheads'
            };
            return concerns[concern] || concern;
        }

        function formatRoutineComplexity(complexity) {
            const levels = {
                'simple': 'Simple 3-4 step routine (cleanser, treatment, moisturizer, sunscreen)',
                'moderate': 'Moderate 5-6 step routine with targeted treatments',
                'comprehensive': 'Comprehensive 7+ step routine for multiple concerns'
            };
            return levels[complexity] || complexity;
        }

        function generateRoutineSteps(results) {
            let steps = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                    <div style="background: #fff5f5; padding: 15px; border-radius: 10px; border-left: 4px solid #ff6b6b;">
                        <h5 style="margin-bottom: 8px; color: #333;">🌅 Morning Routine</h5>
                        <ol style="margin: 0; padding-left: 20px; color: #555;">
                            <li>Gentle cleanser</li>
                            <li>Treatment serum (if needed)</li>
                            <li>Moisturizer</li>
                            <li>Sunscreen (SPF 30+)</li>
                        </ol>
                    </div>
                    <div style="background: #f0f8ff; padding: 15px; border-radius: 10px; border-left: 4px solid #4169e1;">
                        <h5 style="margin-bottom: 8px; color: #333;">🌙 Evening Routine</h5>
                        <ol style="margin: 0; padding-left: 20px; color: #555;">
                            <li>Cleanser (double cleanse if wearing makeup)</li>
                            <li>Treatment products</li>
                            <li>Moisturizer</li>
                            <li>Weekly: Exfoliation or mask</li>
                        </ol>
                    </div>
                </div>
            `;

            if (results.primaryConcerns.length > 0) {
                steps += `
                    <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <h5 style="margin-bottom: 10px; color: #333;">💡 Pro Tips for Your Concerns:</h5>
                        <ul style="margin: 0; padding-left: 20px; color: #555;">
                `;

                if (results.primaryConcerns.includes('acne')) {
                    steps += '<li>Start with salicylic acid 2-3 times per week, gradually increase</li>';
                }
                if (results.primaryConcerns.includes('wrinkles')) {
                    steps += '<li>Consider adding retinol at night, start with 1-2 times per week</li>';
                }
                if (results.primaryConcerns.includes('dark-spots')) {
                    steps += '<li>Vitamin C in morning, consistent sunscreen use is crucial</li>';
                }
                if (results.primaryConcerns.includes('dullness')) {
                    steps += '<li>Weekly gentle exfoliation and brightening treatments</li>';
                }

                steps += `
                        </ul>
                    </div>
                `;
            }

            return steps;
        }

        // Add some nice animations and interactions
        document.addEventListener('DOMContentLoaded', function() {
            // Animate cards on hover
            const cards = document.querySelectorAll('.recommendation-card, .product-item');
            cards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                });
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });
        });

        // Add keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.target.classList.contains('btn')) {
                e.target.click();
            }
        });

        // Add form validation feedback
        function validateForm() {
            const requiredFields = ['age', 'skinType', 'budget'];
            let isValid = true;
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value) {
                    field.style.borderColor = '#ff6b6b';
                    field.style.boxShadow = '0 0 0 3px rgba(255, 107, 107, 0.2)';
                    isValid = false;
                } else {
                    field.style.borderColor = '#28a745';
                    field.style.boxShadow = '0 0 0 3px rgba(40, 167, 69, 0.2)';
                }
            });
            
            return isValid;
        }

        // Update the analyze function to include validation
        document.getElementById('nextStep2').addEventListener('click', function() {
            if (validateForm()) {
                analyzeAndShowResults();
            }
        });
    </script>
</body>
</html>
